
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Library Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <div class="container">
        <h1 class="mt-5">Library Management System</h1>
        <div id="login">
            <h3>Login</h3>
            <input type="text" id="username" placeholder="Username" class="form-control mb-2">
            <input type="password" id="password" placeholder="Password" class="form-control mb-2">
            <button onclick="login()" class="btn btn-primary">Login</button>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" style="display:none;">
            <h3>Admin Panel</h3>
            <h4>Add Book</h4>
            <input type="text" id="bookTitle" placeholder="Title" class="form-control mb-2">
            <input type="text" id="bookAuthor" placeholder="Author" class="form-control mb-2">
            <input type="text" id="bookIsbn" placeholder="ISBN" class="form-control mb-2">
            <button onclick="addBook()" class="btn btn-success">Add Book</button>

            <h4>Update Book</h4>
            <input type="number" id="updateBookId" placeholder="Book ID" class="form-control mb-2">
            <input type="text" id="updateBookTitle" placeholder="Title" class="form-control mb-2">
            <input type="text" id="updateBookAuthor" placeholder="Author" class="form-control mb-2">
            <input type="text" id="updateBookIsbn" placeholder="ISBN" class="form-control mb-2">
            <button onclick="updateBook()" class="btn btn-warning">Update Book</button>

            <h4>Delete Book</h4>
            <input type="number" id="deleteBookId" placeholder="Book ID" class="form-control mb-2">
            <button onclick="deleteBook()" class="btn btn-danger">Delete Book</button>

            <h4>Add Member</h4>
            <input type="text" id="memberName" placeholder="Name" class="form-control mb-2">
            <input type="text" id="memberEmail" placeholder="Email" class="form-control mb-2">
            <button onclick="addMember()" class="btn btn-success">Add Member</button>

            <h4>Update Member</h4>
            <input type="number" id="updateMemberId" placeholder="Member ID" class="form-control mb-2">
            <input type="text" id="updateMemberName" placeholder="Name" class="form-control mb-2">
            <input type="text" id="updateMemberEmail" placeholder="Email" class="form-control mb-2">
            <button onclick="updateMember()" class="btn btn-warning">Update Member</button>

            <h4>Delete Member</h4>
            <input type="number" id="deleteMemberId" placeholder="Member ID" class="form-control mb-2">
            <button onclick="deleteMember()" class="btn btn-danger">Delete Member</button>
        </div>

        <!-- User Panel -->
        <div id="userPanel" style="display:none;">
            <h3>User Panel</h3>
            <h4>Browse Books</h4>
            <input type="text" id="search" placeholder="Search Books" class="form-control mb-2">
            <button onclick="searchBooks()" class="btn btn-primary">Search</button>
            <ul id="bookList" class="list-group"></ul>

            <h4>Issue Book</h4>
            <input type="number" id="issueBookId" placeholder="Book ID" class="form-control mb-2">
            <input type="number" id="issueMemberId" placeholder="Member ID" class="form-control mb-2">
            <button onclick="issueBook()" class="btn btn-primary">Issue Book</button>

            <h4>Reserve Book</h4>
            <input type="number" id="reserveBookId" placeholder="Book ID" class="form-control mb-2">
            <input type="number" id="reserveMemberId" placeholder="Member ID" class="form-control mb-2">
            <button onclick="reserveBook()" class="btn btn-primary">Reserve Book</button>

            <h4>Return Book</h4>
            <input type="number" id="returnTransactionId" placeholder="Transaction ID" class="form-control mb-2">
            <button onclick="returnBook()" class="btn btn-primary">Return Book</button>

            <h4>Send Query</h4>
            <input type="text" id="queryEmail" placeholder="Your Email" class="form-control mb-2">
            <textarea id="queryText" placeholder="Your Query" class="form-control mb-2"></textarea>
            <button onclick="sendQuery()" class="btn btn-primary">Send Query</button>

            <h4>View Report</h4>
            <input type="number" id="reportMemberId" placeholder="Member ID" class="form-control mb-2">
            <button onclick="generateReport()" class="btn btn-primary">Generate Report</button>
            <ul id="reportList" class="list-group"></ul>
        </div>
    </div>

    <script>
        let role = '';

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (username === 'admin' && password === 'admin123') {
                role = 'ADMIN';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('userPanel').style.display = 'none';
                document.getElementById('login').style.display = 'none';
            } else if (username === 'user' && password === 'user123') {
                role = 'USER';
                document.getElementById('userPanel').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('login').style.display = 'none';
                searchBooks();
            } else {
                alert('Invalid credentials');
            }
        }

        function addBook() {
            const book = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                isbn: document.getElementById('bookIsbn').value
            };
            axios.post('/api/books', book)
                .then(() => alert('Book added'))
                .catch(err => alert('Error adding book'));
        }

        function updateBook() {
            const id = document.getElementById('updateBookId').value;
            const book = {
                title: document.getElementById('updateBookTitle').value,
                author: document.getElementById('updateBookAuthor').value,
                isbn: document.getElementById('updateBookIsbn').value
            };
            axios.put(`/api/books/${id}`, book)
                .then(() => alert('Book updated'))
                .catch(err => alert('Error updating book'));
        }

        function deleteBook() {
            const id = document.getElementById('deleteBookId').value;
            axios.delete(`/api/books/${id}`)
                .then(() => alert('Book deleted'))
                .catch(err => alert('Error deleting book'));
        }

        function addMember() {
            const member = {
                name: document.getElementById('memberName').value,
                email: document.getElementById('memberEmail').value,
                role: 'USER'
            };
            axios.post('/api/members', member)
                .then(() => alert('Member added'))
                .catch(err => alert('Error adding member'));
        }

        function updateMember() {
            const id = document.getElementById('updateMemberId').value;
            const member = {
                name: document.getElementById('updateMemberName').value,
                email: document.getElementById('updateMemberEmail').value
            };
            axios.put(`/api/members/${id}`, member)
                .then(() => alert('Member updated'))
                .catch(err => alert('Error updating member'));
        }

        function deleteMember() {
            const id = document.getElementById('deleteMemberId').value;
            axios.delete(`/api/members/${id}`)
                .then(() => alert('Member deleted'))
                .catch(err => alert('Error deleting member'));
        }

        function searchBooks() {
            const search = document.getElementById('search').value.toLowerCase();
            axios.get('/api/books')
                .then(response => {
                    const bookList = document.getElementById('bookList');
                    bookList.innerHTML = '';
                    response.data
                        .filter(book => book.title.toLowerCase().includes(search) || book.author.toLowerCase().includes(search))
                        .forEach(book => {
                            const li = document.createElement('li');
                            li.className = 'list-group-item';
                            li.textContent = `${book.title} by ${book.author} (ID: ${book.id}, ${book.available ? 'Available' : 'Not Available'})`;
                            bookList.appendChild(li);
                        });
                })
                .catch(err => alert('Error fetching books'));
        }

        function issueBook() {
            const bookId = document.getElementById('issueBookId').value;
            const memberId = document.getElementById('issueMemberId').value;
            axios.post(`/api/transactions/issue?bookId=${bookId}&memberId=${memberId}`)
                .then(() => alert('Book issued'))
                .catch(err => alert('Error issuing book'));
        }

        function reserveBook() {
            const bookId = document.getElementById('reserveBookId').value;
            const memberId = document.getElementById('reserveMemberId').value;
            axios.post(`/api/transactions/reserve?bookId=${bookId}&memberId=${memberId}`)
                .then(() => alert('Book reserved'))
                .catch(err => alert('Error reserving book'));
        }

        function returnBook() {
            const transactionId = document.getElementById('returnTransactionId').value;
            axios.post(`/api/transactions/return/${transactionId}`)
                .then(() => alert('Book returned'))
                .catch(err => alert('Error returning book'));
        }

        function sendQuery() {
            const email = document.getElementById('queryEmail').value;
            const query = document.getElementById('queryText').value;
            axios.post(`/api/email/query?userEmail=${email}&query=${query}`)
                .then(() => alert('Query sent'))
                .catch(err => alert('Error sending query'));
        }

        function generateReport() {
            const memberId = document.getElementById('reportMemberId').value;
            axios.get(`/api/transactions/report/${memberId}`)
                .then(response => {
                    const reportList = document.getElementById('reportList');
                    reportList.innerHTML = '';
                    response.data.forEach(transaction => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.textContent = `Book: ${transaction.book.title}, Issued: ${transaction.issueDate}, Due: ${transaction.dueDate}, Returned: ${transaction.returnDate || 'Not Returned'}, Fine: $${transaction.fine}, ${transaction.isReservation ? 'Reservation' : 'Issued'}`;
                        reportList.appendChild(li);
                    });
                })
                .catch(err => alert('Error generating report'));
        }
    </script>
</body>

</html>